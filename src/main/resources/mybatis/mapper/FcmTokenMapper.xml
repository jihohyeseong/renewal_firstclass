<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.renewal_firstclass.dao.FcmDAO">
	<insert id="updateToken">
        INSERT INTO TB_FCM_TOKEN (user_id, fcm_token)
        SELECT #{userId}, #{fcmToken}
        FROM dual
        WHERE NOT EXISTS (
            /* 동일한 (user_id, fcm_token) 쌍이 존재하는지 확인 */
            SELECT 1
            FROM TB_FCM_TOKEN
            WHERE user_id = #{userId}
              AND fcm_token = #{fcmToken}
        )
    </insert>
    
    <select id="findTokenByUserId" parameterType="long" resultType="string">
    	SELECT fcm_token
    	FROM TB_FCM_TOKEN
    	WHERE user_id = #{userId}
    </select>
    
    <delete id="removeToken">
    	DELETE FROM TB_FCM_TOKEN
    	WHERE user_id = #{userId} AND fcm_token = #{fcmToken}
    </delete>
    
    <select id="checkFcmToken">
    	SELECT count(*)
    	FROM TB_FCM_TOKEN
    	WHERE user_id = #{userId} AND fcm_token = #{fcmToken}
    </select>
</mapper>